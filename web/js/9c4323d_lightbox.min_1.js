/*!
 * Lightbox for Bootstrap 3 by @ashleydw
 * https://github.com/ashleydw/lightbox
 *
 * License: https://github.com/ashleydw/lightbox/blob/master/LICENSE
 */
(function(){var d,c;d=jQuery,c=function(a,l){var k,j,i,h=this;return this.options=d.extend({title:null,footer:null,remote:null},d.fn.ekkoLightbox.defaults,l||{}),this.$element=d(a),k="",this.modal_id=this.options.modal_id?this.options.modal_id:"ekkoLightbox-"+Math.floor(1000*Math.random()+1),i='<div class="modal-header"'+(this.options.title||this.options.always_show_close?"":' style="display:none"')+'><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">'+(this.options.title||"&nbsp;")+"</h4></div>",j='<div class="modal-footer"'+(this.options.footer?"":' style="display:none"')+">"+this.options.footer+"</div>",d(document.body).append('<div id="'+this.modal_id+'" class="ekko-lightbox modal fade" tabindex="-1"><div class="modal-dialog"><div class="modal-content">'+i+'<div class="modal-body"><div class="ekko-lightbox-container"><div></div></div></div>'+j+"</div></div></div>"),this.modal=d("#"+this.modal_id),this.modal_dialog=this.modal.find(".modal-dialog").first(),this.modal_content=this.modal.find(".modal-content").first(),this.modal_body=this.modal.find(".modal-body").first(),this.lightbox_container=this.modal_body.find(".ekko-lightbox-container").first(),this.lightbox_body=this.lightbox_container.find("> div:first-child").first(),this.showLoading(),this.modal_arrows=null,this.border={top:parseFloat(this.modal_dialog.css("border-top-width"))+parseFloat(this.modal_content.css("border-top-width"))+parseFloat(this.modal_body.css("border-top-width")),right:parseFloat(this.modal_dialog.css("border-right-width"))+parseFloat(this.modal_content.css("border-right-width"))+parseFloat(this.modal_body.css("border-right-width")),bottom:parseFloat(this.modal_dialog.css("border-bottom-width"))+parseFloat(this.modal_content.css("border-bottom-width"))+parseFloat(this.modal_body.css("border-bottom-width")),left:parseFloat(this.modal_dialog.css("border-left-width"))+parseFloat(this.modal_content.css("border-left-width"))+parseFloat(this.modal_body.css("border-left-width"))},this.padding={top:parseFloat(this.modal_dialog.css("padding-top"))+parseFloat(this.modal_content.css("padding-top"))+parseFloat(this.modal_body.css("padding-top")),right:parseFloat(this.modal_dialog.css("padding-right"))+parseFloat(this.modal_content.css("padding-right"))+parseFloat(this.modal_body.css("padding-right")),bottom:parseFloat(this.modal_dialog.css("padding-bottom"))+parseFloat(this.modal_content.css("padding-bottom"))+parseFloat(this.modal_body.css("padding-bottom")),left:parseFloat(this.modal_dialog.css("padding-left"))+parseFloat(this.modal_content.css("padding-left"))+parseFloat(this.modal_body.css("padding-left"))},this.modal.on("show.bs.modal",this.options.onShow.bind(this)).on("shown.bs.modal",function(){return h.modal_shown(),h.options.onShown.call(h)}).on("hide.bs.modal",this.options.onHide.bind(this)).on("hidden.bs.modal",function(){return h.gallery&&d(document).off("keydown.ekkoLightbox"),h.modal.remove(),h.options.onHidden.call(h)}).modal("show",l),this.modal},c.prototype={modal_shown:function(){var a,e=this;return this.options.remote?(this.gallery=this.$element.data("gallery"),this.gallery&&(this.gallery_items="document.body"===this.options.gallery_parent_selector||""===this.options.gallery_parent_selector?d(document.body).find('*[data-toggle="lightbox"][data-gallery="'+this.gallery+'"]'):this.$element.parents(this.options.gallery_parent_selector).first().find('*[data-toggle="lightbox"][data-gallery="'+this.gallery+'"]'),this.gallery_index=this.gallery_items.index(this.$element),d(document).on("keydown.ekkoLightbox",this.navigate.bind(this)),this.options.directional_arrows&&this.gallery_items.length>1&&(this.lightbox_container.prepend('<div class="ekko-lightbox-nav-overlay"><a href="#" class="'+this.strip_stops(this.options.left_arrow_class)+'"></a><a href="#" class="'+this.strip_stops(this.options.right_arrow_class)+'"></a></div>'),this.modal_arrows=this.lightbox_container.find("div.ekko-lightbox-nav-overlay").first(),this.lightbox_container.find("a"+this.strip_spaces(this.options.left_arrow_class)).on("click",function(b){return b.preventDefault(),e.navigate_left()}),this.lightbox_container.find("a"+this.strip_spaces(this.options.right_arrow_class)).on("click",function(b){return b.preventDefault(),e.navigate_right()}))),this.options.type?"image"===this.options.type?this.preloadImage(this.options.remote,!0):"youtube"===this.options.type&&(a=this.getYoutubeId(this.options.remote))?this.showYoutubeVideo(a):"vimeo"===this.options.type?this.showVimeoVideo(this.options.remote):"instagram"===this.options.type?this.showInstagramVideo(this.options.remote):this.error('Could not detect remote target type. Force the type using data-type="image|youtube|vimeo"'):this.detectRemoteType(this.options.remote)):this.error("No remote target given")},strip_stops:function(b){return b.replace(/\./g,"")},strip_spaces:function(b){return b.replace(/\s/g,"")},isImage:function(b){return b.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSwf:function(b){return b.match(/\.(swf)((\?|#).*)?$/i)},getYoutubeId:function(f){var e;return e=f.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/),e&&11===e[2].length?e[2]:!1},getVimeoId:function(b){return b.indexOf("vimeo")>0?b:!1},getInstagramId:function(b){return b.indexOf("instagram")>0?b:!1},navigate:function(b){if(b=b||window.event,39===b.keyCode||37===b.keyCode){if(39===b.keyCode){return this.navigate_right()}if(37===b.keyCode){return this.navigate_left()}}},navigate_left:function(){var a;if(1!==this.gallery_items.length){return this.showLoading(),0===this.gallery_index?this.gallery_index=this.gallery_items.length-1:this.gallery_index--,this.options.onNavigate("left",this.gallery_index),this.$element=d(this.gallery_items.get(this.gallery_index)),this.updateTitleAndFooter(),a=this.$element.attr("data-remote")||this.$element.attr("href"),this.detectRemoteType(a,this.$element.attr("data-type"))}},navigate_right:function(){var a,e;if(1!==this.gallery_items.length){return this.showLoading(),this.gallery_index===this.gallery_items.length-1?this.gallery_index=0:this.gallery_index++,this.options.onNavigate("right",this.gallery_index),this.$element=d(this.gallery_items.get(this.gallery_index)),e=this.$element.attr("data-remote")||this.$element.attr("href"),this.updateTitleAndFooter(),this.detectRemoteType(e,this.$element.attr("data-type")),this.gallery_index+1<this.gallery_items.length&&(a=d(this.gallery_items.get(this.gallery_index+1),!1),e=a.attr("data-remote")||a.attr("href"),"image"===a.attr("data-type")||this.isImage(e))?this.preloadImage(e,!1):void 0}},detectRemoteType:function(f,e){var g;return"image"===e||this.isImage(f)?(this.options.type="image",this.preloadImage(f,!0)):"youtube"===e||(g=this.getYoutubeId(f))?(this.options.type="youtube",this.showYoutubeVideo(g)):"vimeo"===e||(g=this.getVimeoId(f))?(this.options.type="vimeo",this.showVimeoVideo(g)):"instagram"===e||(g=this.getInstagramId(f))?(this.options.type="instagram",this.showInstagramVideo(g)):this.error('Could not detect remote target type. Force the type using data-type="image|youtube|vimeo"')},updateTitleAndFooter:function(){var f,e,h,g;return h=this.modal_content.find(".modal-header"),e=this.modal_content.find(".modal-footer"),g=this.$element.data("title")||"",f=this.$element.data("footer")||"",g||this.options.always_show_close?h.css("display","").find(".modal-title").html(g||"&nbsp;"):h.css("display","none"),f?e.css("display","").html(f):e.css("display","none"),this},showLoading:function(){return this.lightbox_body.html('<div class="modal-loading">Loading..</div>'),this},showYoutubeVideo:function(f){var e,h,g;return e=560/315,g=this.$element.data("width")||560,g=this.checkDimensions(g),h=g/e,this.resize(g),this.lightbox_body.html('<iframe width="'+g+'" height="'+h+'" src="//www.youtube.com/embed/'+f+'?badge=0&autoplay=1&html5=1" frameborder="0" allowfullscreen></iframe>'),this.modal_arrows?this.modal_arrows.css("display","none"):void 0},showVimeoVideo:function(f){var e,h,g;return e=500/281,g=this.$element.data("width")||560,g=this.checkDimensions(g),h=g/e,this.resize(g),this.lightbox_body.html('<iframe width="'+g+'" height="'+h+'" src="'+f+'?autoplay=1" frameborder="0" allowfullscreen></iframe>'),this.modal_arrows?this.modal_arrows.css("display","none"):void 0},showInstagramVideo:function(f){var e,g;return g=this.$element.data("width")||612,g=this.checkDimensions(g),e=g,this.resize(g),this.lightbox_body.html('<iframe width="'+g+'" height="'+e+'" src="'+this.addTrailingSlash(f)+'embed/" frameborder="0" allowfullscreen></iframe>'),this.modal_arrows?this.modal_arrows.css("display","none"):void 0},error:function(b){return this.lightbox_body.html(b),this},preloadImage:function(a,h){var g,f=this;return g=new Image,(null==h||h===!0)&&(g.onload=function(){var e;return e=d("<img />"),e.attr("src",g.src),e.addClass("img-responsive"),f.lightbox_body.html(e),f.modal_arrows&&f.modal_arrows.css("display","block"),f.resize(g.width)},g.onerror=function(){return f.error("Failed to load image: "+a)}),g.src=a,g},resize:function(a){var e;return e=a+this.border.left+this.padding.left+this.padding.right+this.border.right,this.modal_dialog.css("width","auto").css("max-width",e),this.lightbox_container.find("a").css("padding-top",function(){return d(this).parent().height()/2}),this},checkDimensions:function(f){var e,g;return g=f+this.border.left+this.padding.left+this.padding.right+this.border.right,e=document.body.clientWidth,g>e&&(f=this.modal_body.width()),f},close:function(){return this.modal.modal("hide")},addTrailingSlash:function(b){return"/"!==b.substr(-1)&&(b+="/"),b}},d.fn.ekkoLightbox=function(a){return this.each(function(){var b;return b=d(this),a=d.extend({remote:b.attr("data-remote")||b.attr("href"),gallery_parent_selector:b.attr("data-parent"),type:b.attr("data-type")},a,b.data()),new c(this,a),this})},d.fn.ekkoLightbox.defaults={gallery_parent_selector:"*:not(.row)",left_arrow_class:".glyphicon .glyphicon-chevron-left",right_arrow_class:".glyphicon .glyphicon-chevron-right",directional_arrows:!0,type:null,always_show_close:!0,onShow:function(){},onShown:function(){},onHide:function(){},onHidden:function(){},onNavigate:function(){}}}).call(this);